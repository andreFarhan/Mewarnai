<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Studio Gambar ‚Äì Palet ‚Ä¢ Template ‚Ä¢ Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    html,body{height:100%;background:#f8fafc;font-family:Inter,system-ui,sans-serif}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 1px 1px rgba(0,0,0,.04)}
    .btn{padding:.5rem .75rem;border-radius:.75rem;border:1px solid #e5e7eb;background:#fff;box-shadow:0 1px 1px rgba(0,0,0,.04);transition:background-color .15s,box-shadow .15s,transform .1s}
    .btn:hover{background:#f8fafc;box-shadow:0 4px 14px rgba(2,6,23,.08)}
    .btn:active{transform:scale(.97)}
    .tool-active{background:#4f46e5;color:#fff;border-color:#4f46e5}
    .swatch{width:24px;height:24px;border-radius:9999px;border:1px solid #cbd5e1;cursor:pointer}
    .swatch:hover{box-shadow:0 0 0 3px rgba(79,70,229,.25)}
    canvas{touch-action:none}
    .dropzone{border:1.5px dashed #cbd5e1;border-radius:12px;padding:.75rem;text-align:center;color:#64748b}
    .dropzone.drag{border-color:#4f46e5;background:#eef2ff;color:#3730a3}
    input[type="url"],select{border:1px solid #e5e7eb;border-radius:.6rem;padding:.45rem .6rem;background:#fff}
    /* galeri */
    #fruitGallery img,
    #animalGallery img,
    #objectGallery img,
    #symbolGallery img {
      cursor:pointer;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:6px;
      background:#fff;
      transition:box-shadow .15s
    }
    #fruitGallery img:hover,
    #animalGallery img:hover,
    #objectGallery img:hover,
    #symbolGallery img:hover {
      box-shadow:0 6px 18px rgba(2,6,23,.10)
    }
  </style>
</head>
<body>
  <div class="max-w-7xl mx-auto p-5 md:p-8 grid grid-cols-1 lg:grid-cols-[320px_1fr] gap-6">
    <!-- SIDEBAR -->
    <aside class="panel p-4 space-y-6">
      <!-- 1) Palet Warna -->
      <div class="space-y-3">
        <h2 class="font-semibold text-slate-700">Palet Warna</h2>
        <div class="flex items-center gap-2">
          <select id="paletteSet">
            <option>Dasar</option>
            <option>Pastel</option>
            <option>Tropis</option>
            <option>Monokrom</option>
            <option>Kulit</option>
          </select>
          <input id="customColor" type="color" value="#111827" title="Warna custom" />
        </div>
        <div id="palette" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- 2) Template bawaan: buah & hewan -->
      <div class="space-y-4">
        <div>
          <h2 class="font-semibold text-slate-700 mb-2">Template Gambar (klik = ganti)</h2>
          <div class="grid grid-cols-4 gap-2" id="fruitGallery"></div>
        </div>
        <div>
          <div class="grid grid-cols-4 gap-2" id="animalGallery"></div>
        </div>
        <div>
          <div class="grid grid-cols-4 gap-2" id="objectGallery"></div>
        </div>
        <div>
          <div class="grid grid-cols-4 gap-2" id="symbolGallery"></div>
        </div>
      </div>


      <!-- 3) Template dari gambar (upload/url) -->
      <div class="space-y-3">
        <h2 class="font-semibold text-slate-700">Template dari Gambar</h2>
        <div id="dz" class="dropzone">Tarik & lepas gambar ke sini</div>
        <div class="flex items-center gap-2">
          <input id="fileInput" class="hidden" type="file" accept="image/*" />
          <button id="pickBtn" class="btn">üìÇ Upload gambar</button>
          <button id="clearTemplate" class="btn">üóëÔ∏è Hapus</button>
        </div>
        <div class="space-y-2">
          <label class="text-sm text-slate-600">Atau pakai URL:</label>
          <div class="flex items-center gap-2">
            <input id="urlInput" type="url" placeholder="https://..." />
            <button id="useUrl" class="btn">Go!</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm text-slate-600 flex items-center gap-2">Opasitas
            <input id="opacity" type="range" min="10" max="100" value="80" />
          </label><br>
          <label class="text-sm text-slate-600 flex items-center gap-2">Skala
            <input id="scale" type="range" min="20" max="200" value="120" />
          </label><br>
          <button id="centerBtn" class="btn">üéØ Center</button>
          <button id="fitBtn" class="btn">üñºÔ∏è Fit ke kanvas</button>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="panel p-4 md:p-5 flex flex-col">
      <header class="flex flex-wrap items-center gap-2 mb-3">
        <div class="flex items-center gap-2">
          <button class="btn tool-btn" data-tool="brush" title="Kuas (gambar bebas)">‚úèÔ∏è Kuas</button>
          <button class="btn tool-btn" data-tool="eraser" title="Penghapus (transparan)">üßΩ Penghapus</button>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <label class="text-sm text-slate-600">Kuas</label>
          <input id="brushSize" type="range" min="2" max="64" value="12"/>
          <button id="undoBtn" class="btn" title="Undo">‚Ü∂ Undo</button>
          <button id="clearBtn" class="btn" title="Bersihkan coretan">üßπ Bersihkan Warna</button>
          <button id="saveBtn" class="btn" title="Simpan PNG">üíæ Simpan</button>
        </div>
      </header>

      <div class="relative aspect-[4/3] rounded-xl border border-slate-200 overflow-hidden bg-white">
        <canvas id="stage" class="absolute inset-0 w-full h-full"></canvas>
        <canvas id="overlay" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
      </div>
    </main>
  </div>

  <script>
    // ====== STATE ======
    const state = {
      tool: 'brush',
      color: '#111827',
      brushSize: 12,
      strokes: [],
      history: [],
      cursorPos: null,
      template: { img: null, x: 0, y: 0, scale: 1.2, opacity: .8 }
    };

    // ====== CANVAS ======
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const octx = overlay.getContext('2d');

    function resizeCanvas(){
      const rect = canvas.parentElement.getBoundingClientRect();
      const dpr = Math.min(devicePixelRatio||1, 2);
      [canvas, overlay].forEach(c=>{ c.width=Math.floor(rect.width*dpr); c.height=Math.floor(rect.height*dpr); c.style.width=rect.width+'px'; c.style.height=rect.height+'px'; });
      ctx.setTransform(dpr,0,0,dpr,0,0); octx.setTransform(dpr,0,0,dpr,0,0);
      if(!state.template.x && !state.template.y) centerTemplate();
      drawAll(); drawOverlay();
    }
    window.addEventListener('resize', resizeCanvas);

    // ====== DRAW ======
    function drawAll(){
      const w = canvas.clientWidth, h = canvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      // template
      if(state.template.img){
        const {img,x,y,scale,opacity} = state.template;
        const iw=img.naturalWidth, ih=img.naturalHeight; const dw=iw*scale, dh=ih*scale;
        ctx.save(); ctx.globalAlpha = opacity; ctx.drawImage(img, x-dw/2, y-dh/2, dw, dh); ctx.restore();
      }
      // strokes
      ctx.lineCap='round'; ctx.lineJoin='round';
      state.strokes.forEach(st=>{ ctx.save(); ctx.globalCompositeOperation = st.erase ? 'destination-out' : 'source-over'; ctx.strokeStyle = st.color; ctx.lineWidth = st.size; ctx.beginPath(); st.points.forEach((p,i)=>{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); }); ctx.stroke(); ctx.restore(); });
    }

    function drawOverlay(){
      const w = overlay.clientWidth, h = overlay.clientHeight; octx.clearRect(0,0,w,h);
      if(state.cursorPos && (state.tool==='brush' || state.tool==='eraser')){ octx.save(); octx.beginPath(); octx.arc(state.cursorPos.x, state.cursorPos.y, state.brushSize/2, 0, Math.PI*2); octx.lineWidth=1.5; octx.setLineDash(state.tool==='eraser'?[4,4]:[]); octx.strokeStyle='rgba(15,23,42,.85)'; octx.stroke(); octx.restore(); }
    }

    // ====== HISTORY ======
    function pushHistory(){ const snap = JSON.stringify({ strokes: state.strokes.map(s=>({points:s.points.map(p=>({...p})), size:s.size, color:s.color, erase:s.erase})), template:{ x:state.template.x, y:state.template.y, scale:state.template.scale, opacity:state.template.opacity, has:!!state.template.img } }); state.history.push(snap); if(state.history.length>80) state.history.shift(); }
    function undo(){ const snap = state.history.pop(); if(!snap) return; const data=JSON.parse(snap); state.strokes=data.strokes; if(state.template.img && data.template.has){ state.template.x=data.template.x; state.template.y=data.template.y; state.template.scale=data.template.scale; state.template.opacity=data.template.opacity; } drawAll(); drawOverlay(); }

    // ====== TOOLS ======
    function setTool(name){ state.tool=name; document.querySelectorAll('.tool-btn').forEach(b=>b.classList.toggle('tool-active', b.dataset.tool===name)); drawOverlay(); }

    let drawing=false;
    canvas.addEventListener('pointerdown', (e)=>{ const pos=pointerPos(e); canvas.setPointerCapture(e.pointerId); if(state.tool==='brush' || state.tool==='eraser'){ pushHistory(); drawing=true; const stroke={points:[pos], size:state.brushSize, color:state.color, erase:(state.tool==='eraser')}; state.strokes.push(stroke); drawAll(); }});
    canvas.addEventListener('pointermove', (e)=>{ const pos=pointerPos(e); state.cursorPos=pos; drawOverlay(); if(drawing){ const stroke=state.strokes[state.strokes.length-1]; stroke.points.push(pos); drawAll(); }});
    canvas.addEventListener('pointerup', ()=>{ drawing=false; });
    canvas.addEventListener('pointercancel', ()=>{ drawing=false; });
    canvas.addEventListener('pointerleave', ()=>{ state.cursorPos=null; drawOverlay(); });
    function pointerPos(e){ const r=canvas.getBoundingClientRect(); return {x:(e.touches?e.touches[0].clientX:e.clientX)-r.left, y:(e.touches?e.touches[0].clientY:e.clientY)-r.top}; }

    // ====== UI BUTTONS ======
    document.querySelectorAll('.tool-btn').forEach(btn=>btn.addEventListener('click', ()=> setTool(btn.dataset.tool)));
    document.getElementById('brushSize').addEventListener('input', (e)=>{ state.brushSize=+e.target.value; drawOverlay(); });
    document.getElementById('undoBtn').addEventListener('click', undo);
    document.getElementById('clearBtn').addEventListener('click', ()=>{ pushHistory(); state.strokes=[]; drawAll(); drawOverlay(); });
    document.getElementById('saveBtn').addEventListener('click', ()=>{ const w=canvas.width,h=canvas.height; const t=document.createElement('canvas'); t.width=w; t.height=h; const tctx=t.getContext('2d'); tctx.fillStyle='#ffffff'; tctx.fillRect(0,0,w,h); // latar putih
      // gambar template + stroke ke export canvas dengan skala DPR
      if(state.template.img){ const {img,x,y,scale,opacity}=state.template; const iw=img.naturalWidth, ih=img.naturalHeight; const dw=iw*scale, dh=ih*scale; tctx.save(); tctx.globalAlpha=opacity; tctx.drawImage(img, x*devicePixelRatio-(dw*devicePixelRatio)/2, y*devicePixelRatio-(dh*devicePixelRatio)/2, dw*devicePixelRatio, dh*devicePixelRatio); tctx.restore(); }
      tctx.drawImage(canvas,0,0); const a=document.createElement('a'); a.download='karya.png'; a.href=t.toDataURL('image/png'); a.click(); });

    // ====== TEMPLATE: Upload / URL ======
    const dz=document.getElementById('dz'); const fileInput=document.getElementById('fileInput'); const pickBtn=document.getElementById('pickBtn'); const urlInput=document.getElementById('urlInput');
    document.getElementById('useUrl').addEventListener('click', ()=>{ const url=urlInput.value.trim(); if(url) loadTemplateFromURL(url); });
    document.getElementById('clearTemplate').addEventListener('click', ()=>{ state.template.img=null; state.strokes=[]; drawAll(); });
    document.getElementById('opacity').addEventListener('input', (e)=>{ state.template.opacity=(+e.target.value)/100; drawAll(); });
    document.getElementById('scale').addEventListener('input', (e)=>{ state.template.scale=(+e.target.value)/100; drawAll(); });
    document.getElementById('centerBtn').addEventListener('click', ()=>{ centerTemplate(); drawAll(); });
    document.getElementById('fitBtn').addEventListener('click', ()=>{ fitTemplate(); drawAll(); });

    pickBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{ const f=e.target.files && e.target.files[0]; if(!f) return; loadTemplateFromFile(f); });
    ;['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,(e)=>{e.preventDefault(); dz.classList.add('drag');}));
    ;['dragleave','drop'].forEach(ev=>dz.addEventListener(ev,(e)=>{e.preventDefault(); dz.classList.remove('drag');}));
    dz.addEventListener('drop',(e)=>{ const f=e.dataTransfer.files && e.dataTransfer.files[0]; if(!f) return; loadTemplateFromFile(f); });

    function loadTemplateFromFile(file){ const reader=new FileReader(); reader.onload=()=>{ const img=new Image(); img.onload=()=> setTemplateImage(img); img.src=reader.result; }; reader.readAsDataURL(file); }
    function loadTemplateFromURL(url){ const img=new Image(); img.crossOrigin='anonymous'; img.onload=()=> setTemplateImage(img); img.onerror=()=> alert('Gagal load gambar (cek URL/CORS).'); img.src=url; }
    function setTemplateImage(img){ pushHistory(); state.template.img=img; state.template.scale=1.2; state.template.opacity=.8; centerTemplate(); state.strokes=[]; drawAll(); drawOverlay(); }
    function centerTemplate(){ const rect=canvas.getBoundingClientRect(); state.template.x=rect.width/2; state.template.y=rect.height/2; }
    function fitTemplate(){ const rect=canvas.getBoundingClientRect(); if(!state.template.img) return; const {img}=state.template; const iw=img.naturalWidth, ih=img.naturalHeight; const scaleW=(rect.width*0.9)/iw; const scaleH=(rect.height*0.9)/ih; state.template.scale=Math.min(scaleW, scaleH); centerTemplate(); }

    // ====== PALETTES ======
    const PALETTE_SETS={
      'Dasar':['#000000','#1f2937','#4b5563','#9ca3af','#ffffff','#ef4444','#f97316','#f59e0b','#ffff00','#84cc16','#22c55e','#06b6d4','#3b82f6','#8b5cf6','#ec4899'],
      'Pastel':['#f8b4b4','#fbd38d','#fce588','#c6f6d5','#b2f5ea','#bee3f8','#d6bcfa','#fbb6ce','#e9d8fd','#e2e8f0'],
      'Tropis':['#ef4444','#f97316','#f59e0b','#84cc16','#10b981','#06b6d4','#0ea5e9','#22d3ee','#14b8a6','#a3e635'],
      'Monokrom':['#000000','#111827','#1f2937','#374151','#4b5563','#6b7280','#9ca3af','#d1d5db','#e5e7eb','#ffffff'],
      'Kulit':['#ffdbac','#f1c27d','#e0ac69','#c68642','#8d5524','#7f5539','#f5e1da','#e2b9a8','#a1665e','#5c3d2e']
    };
    const paletteWrap=document.getElementById('palette'); const paletteSetSel=document.getElementById('paletteSet'); const customColor=document.getElementById('customColor');
    function buildPalette(setName='Dasar'){ paletteWrap.innerHTML=''; const colors=PALETTE_SETS[setName]||PALETTE_SETS['Dasar']; colors.forEach(col=>{ const sw=document.createElement('button'); sw.className='swatch'; sw.style.background=col; sw.title=col; sw.addEventListener('click', ()=>{ state.color=toHex(col); highlightColor(state.color); }); paletteWrap.appendChild(sw); }); highlightColor(state.color); }
    function highlightColor(col){ document.querySelectorAll('.swatch').forEach(s=>{ const active=toHex(s.style.background)===toHex(col); s.style.boxShadow=active?'0 0 0 3px rgba(79,70,229,.65)':'none'; }); }
    function toHex(css){ if(css.startsWith('#')) return css.toLowerCase(); const m=css.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/); if(!m) return css; return '#'+[+m[1],+m[2],+m[3]].map(v=>v.toString(16).padStart(2,'0')).join(''); }
    paletteSetSel.addEventListener('change', ()=> buildPalette(paletteSetSel.value));
    customColor.addEventListener('input', (e)=>{ state.color=e.target.value; highlightColor(state.color); });

    // ====== BUILTIN GALLERY (pakai SVG data URL) ======
    function svgData(svg){ 
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg); 
    }
    const STROKE = '#0f172a';

    // ====== BUAH ======
    const FRUIT_IMGS = [
      // Stroberi bentuk hati
      {
        alt: 'Stroberi',
        data: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120' fill='none'
          stroke='${STROKE}' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>
          <path d='M60 30c12-8 30-4 32 10 2 18-16 40-32 52-16-12-34-34-32-52 2-14 20-18 32-10z'/>
          <path d='M60 30c-4-6-2-12 6-14 6-2 12 0 16 4'/>
        </svg>`)
      },
      // Lemon
      {
        alt: 'Lemon',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M464 144C460.8 144 457.8 144.4 455.1 145.3C436 150.8 409 156 380.8 148.6C323.4 133.7 256.2 156 206.1 206.1C156 256.2 133.7 323.4 148.6 380.8C155.9 409 150.8 436 145.3 455.1C144.5 457.9 144 460.9 144 464C144 481.7 158.3 496 176 496C179.2 496 182.2 495.6 184.9 494.7C204 489.2 231 484 259.2 491.4C316.6 506.3 383.8 484 433.9 433.9C484 383.8 506.3 316.6 491.4 259.2C484.1 231 489.2 204 494.7 184.9C495.5 182.1 496 179.1 496 176C496 158.3 481.7 144 464 144zM464 96C508.2 96 544 131.8 544 176C544 183.7 542.9 191.2 540.9 198.3C536.3 214.1 533.8 231.2 537.9 247.2C558 324.8 527 408.7 467.9 467.9C408.8 527.1 324.8 558.1 247.2 537.9C231.2 533.8 214.2 536.3 198.3 540.9C191.2 542.9 183.7 544 176 544C131.8 544 96 508.2 96 464C96 456.3 97.1 448.8 99.1 441.7C103.7 425.9 106.2 408.8 102.1 392.8C82 315.2 113 231.3 172.1 172.1C231.2 112.9 315.3 82 392.8 102.1C408.8 106.2 425.8 103.7 441.7 99.1C448.8 97.1 456.3 96 464 96zM342.7 231C290.7 246.2 246.2 290.7 231 342.7C227.3 355.4 213.9 362.7 201.2 359C188.5 355.3 181.2 342 185 329.3C204.8 261.6 261.6 204.8 329.3 185C342 181.3 355.4 188.6 359.1 201.3C362.8 214 355.5 227.4 342.8 231.1z"/></svg>`)
      },
      // Apel
      {
        alt: 'Apel',
        data: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120' fill='none'
          stroke='${STROKE}' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>
          <circle cx='60' cy='70' r='28'/>
          <path d='M60 42c0-8 8-12 14-12'/>
        </svg>`)
      }
    ];

    // ====== HEWAN ======
    const ANIMAL_IMGS = [
      // Kucing kepala
      {
        alt: 'Kucing (kepala)',
        data: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120' fill='none'
          stroke='${STROKE}' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>
          <path d='M30 44l-8-14 18 8M90 44l8-14-18 8'/>
          <path d='M28 86c0-24 18-40 32-40s32 16 32 40'/>
          <path d='M52 62v8M68 62v8'/>
          <path d='M60 60l3 4h-6l3-4'/>
        </svg>`)
      },
      // Kelinci
      {
        alt: 'Kelinci',
        data: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120' fill='none'
          stroke='${STROKE}' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>
          <ellipse cx='60' cy='70' rx='28' ry='22'/>
          <path d='M48 28c-6 14-2 24 0 28M72 28c6 14 2 24 0 28'/>
          <circle cx='50' cy='68' r='2'/><circle cx='70' cy='68' r='2'/>
        </svg>`)
      },
      // Ikan
      {
        alt: 'Ikan',
        data: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120' fill='none'
          stroke='${STROKE}' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'>
          <path d='M20 60c20-20 60-20 80 0-20 20-60 20-80 0z'/>
          <path d='M20 60l-10-6v12l10-6z'/>
          <circle cx='80' cy='60' r='2'/>
        </svg>`)
      }
    ];

    // ====== BENDA ======
    const OBJECT_IMGS = [
      // Awan
      {
        alt: 'Awan',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M112 256C112 167.6 183.6 96 272 96C319.1 96 361.4 116.4 390.7 148.7C401.3 145.6 412.5 144 424 144C490.3 144 544 197.7 544 264C544 277.2 541.9 289.9 537.9 301.8C579.5 322.9 608 366.1 608 416C608 486.7 550.7 544 480 544L176 544C96.5 544 32 479.5 32 400C32 343.2 64.9 294.1 112.7 270.6C112.3 265.8 112 260.9 112 256zM272 144C210.1 144 160 194.1 160 256C160 264.4 160.9 272.6 162.7 280.5C165.4 292.6 158.4 304.8 146.6 308.6C107.9 321 80 357.3 80 400C80 453 123 496 176 496L480 496C524.2 496 560 460.2 560 416C560 378.6 534.3 347.1 499.5 338.4C492 336.5 485.9 331.2 483 324.1C480.1 317 480.9 308.9 485 302.4C492 291.3 496 278.2 496 264.1C496 224.3 463.8 192.1 424 192.1C412.9 192.1 402.5 194.6 393.2 199C382.7 204 370.1 200.7 363.4 191.2C343.1 162.6 309.7 144.1 272.1 144.1z"/></svg>`)
      },
      // Bulan
      {
        alt: 'Bulan',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M303.3 112.7C196.2 121.2 112 210.8 112 320C112 434.9 205.1 528 320 528C353.3 528 384.7 520.2 412.6 506.3C309.2 482.9 232 390.5 232 280C232 214.2 259.4 154.9 303.3 112.7zM64 320C64 178.6 178.6 64 320 64C339.4 64 358.4 66.2 376.7 70.3C386.6 72.5 394 80.8 395.2 90.8C396.4 100.8 391.2 110.6 382.1 115.2C321.5 145.4 280 207.9 280 280C280 381.6 362.4 464 464 464C469 464 473.9 463.8 478.8 463.4C488.9 462.6 498.4 468.2 502.6 477.5C506.8 486.8 504.6 497.6 497.3 504.6C451.3 548.8 388.8 576 320 576C178.6 576 64 461.4 64 320z"/></svg>`)
      },
      // Mata
      {
        alt: 'Mata',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320 144C254.8 144 201.2 173.6 160.1 211.7C121.6 247.5 95 290 81.4 320C95 350 121.6 392.5 160.1 428.3C201.2 466.4 254.8 496 320 496C385.2 496 438.8 466.4 479.9 428.3C518.4 392.5 545 350 558.6 320C545 290 518.4 247.5 479.9 211.7C438.8 173.6 385.2 144 320 144zM127.4 176.6C174.5 132.8 239.2 96 320 96C400.8 96 465.5 132.8 512.6 176.6C559.4 220.1 590.7 272 605.6 307.7C608.9 315.6 608.9 324.4 605.6 332.3C590.7 368 559.4 420 512.6 463.4C465.5 507.1 400.8 544 320 544C239.2 544 174.5 507.2 127.4 463.4C80.6 419.9 49.3 368 34.4 332.3C31.1 324.4 31.1 315.6 34.4 307.7C49.3 272 80.6 220 127.4 176.6zM320 400C364.2 400 400 364.2 400 320C400 290.4 383.9 264.5 360 250.7C358.6 310.4 310.4 358.6 250.7 360C264.5 383.9 290.4 400 320 400zM240.4 311.6C242.9 311.9 245.4 312 248 312C283.3 312 312 283.3 312 248C312 245.4 311.8 242.9 311.6 240.4C274.2 244.3 244.4 274.1 240.5 311.5zM286 196.6C296.8 193.6 308.2 192.1 319.9 192.1C328.7 192.1 337.4 193 345.7 194.7C346 194.8 346.2 194.8 346.5 194.9C404.4 207.1 447.9 258.6 447.9 320.1C447.9 390.8 390.6 448.1 319.9 448.1C258.3 448.1 206.9 404.6 194.7 346.7C192.9 338.1 191.9 329.2 191.9 320.1C191.9 309.1 193.3 298.3 195.9 288.1C196.1 287.4 196.2 286.8 196.4 286.2C208.3 242.8 242.5 208.6 285.9 196.7z"/></svg>`)
      }
    ];

    // ====== SIMBOL ======
    const SYMBOL_IMGS = [
      // Hati
      {
        alt: 'Hati',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M442.9 144C415.6 144 389.9 157.1 373.9 179.2L339.5 226.8C335 233 327.8 236.7 320.1 236.7C312.4 236.7 305.2 233 300.7 226.8L266.3 179.2C250.3 157.1 224.6 144 197.3 144C150.3 144 112.2 182.1 112.2 229.1C112.2 279 144.2 327.5 180.3 371.4C221.4 421.4 271.7 465.4 306.2 491.7C309.4 494.1 314.1 495.9 320.2 495.9C326.3 495.9 331 494.1 334.2 491.7C368.7 465.4 419 421.3 460.1 371.4C496.3 327.5 528.2 279 528.2 229.1C528.2 182.1 490.1 144 443.1 144zM335 151.1C360 116.5 400.2 96 442.9 96C516.4 96 576 155.6 576 229.1C576 297.7 533.1 358 496.9 401.9C452.8 455.5 399.6 502 363.1 529.8C350.8 539.2 335.6 543.9 320 543.9C304.4 543.9 289.2 539.2 276.9 529.8C240.4 502 187.2 455.5 143.1 402C106.9 358.1 64 297.7 64 229.1C64 155.6 123.6 96 197.1 96C239.8 96 280 116.5 305 151.1L320 171.8L335 151.1z"/></svg>`)
      },
      // Bintang
      {
        alt: 'Bintang',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320.1 32C329.1 32 337.4 37.1 341.5 45.1L415 189.3L574.9 214.7C583.8 216.1 591.2 222.4 594 231C596.8 239.6 594.5 249 588.2 255.4L473.7 369.9L499 529.8C500.4 538.7 496.7 547.7 489.4 553C482.1 558.3 472.4 559.1 464.4 555L320.1 481.6L175.8 555C167.8 559.1 158.1 558.3 150.8 553C143.5 547.7 139.8 538.8 141.2 529.8L166.4 369.9L52 255.4C45.6 249 43.4 239.6 46.2 231C49 222.4 56.3 216.1 65.3 214.7L225.2 189.3L298.8 45.1C302.9 37.1 311.2 32 320.2 32zM320.1 108.8L262.3 222C258.8 228.8 252.3 233.6 244.7 234.8L119.2 254.8L209 344.7C214.4 350.1 216.9 357.8 215.7 365.4L195.9 490.9L309.2 433.3C316 429.8 324.1 429.8 331 433.3L444.3 490.9L424.5 365.4C423.3 357.8 425.8 350.1 431.2 344.7L521 254.8L395.5 234.8C387.9 233.6 381.4 228.8 377.9 222L320.1 108.8z"/></svg>`)
      },
      // Tangan
      {
        alt: 'Tangan',
        data: svgData(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320.5 64C295.2 64 273.3 78.7 262.9 100C255.9 97.4 248.4 96 240.5 96C205.2 96 176.5 124.7 176.5 160L176.5 325.5L173.8 322.8C148.8 297.8 108.3 297.8 83.3 322.8C58.3 347.8 58.3 388.3 83.3 413.3L171 501C219 549 284.1 576 352 576L368.5 576C370 576 371.5 575.9 373 575.6C464.7 569.4 538 496.2 544.1 404.5C544.4 403 544.5 401.5 544.5 400L544.5 224C544.5 188.7 515.8 160 480.5 160C475 160 469.6 160.7 464.5 162L464.5 160C464.5 124.7 435.8 96 400.5 96C392.6 96 385.1 97.4 378.1 100C367.7 78.7 345.8 64 320.5 64zM304.5 160.1L304.5 160L304.5 128C304.5 119.2 311.7 112 320.5 112C329.3 112 336.5 119.2 336.5 128L336.5 296C336.5 309.3 347.2 320 360.5 320C373.8 320 384.5 309.3 384.5 296L384.5 160C384.5 151.2 391.7 144 400.5 144C409.3 144 416.5 151.2 416.5 160L416.5 296C416.5 309.3 427.2 320 440.5 320C453.8 320 464.5 309.3 464.5 296L464.5 224C464.5 215.2 471.7 208 480.5 208C489.3 208 496.5 215.2 496.5 224L496.5 396.9C496.4 397.5 496.4 398.2 496.3 398.8C492.9 468.5 437 524.4 367.3 527.8C366.7 527.8 366 527.9 365.4 528L352 528C296.9 528 244 506.1 205 467.1L117.2 379.3C111 373.1 111 362.9 117.2 356.7C123.4 350.5 133.6 350.5 139.8 356.7L183.5 400.4C190.4 407.3 200.7 409.3 209.7 405.6C218.7 401.9 224.5 393.1 224.5 383.4L224.5 160C224.5 151.2 231.7 144 240.5 144C249.3 144 256.5 151.1 256.5 159.9L256.5 296C256.5 309.3 267.2 320 280.5 320C293.8 320 304.5 309.3 304.5 296L304.5 160.1z"/></svg>`)
      }
    ];

    function populateBuiltinGalleries(){
      const galleries = [
        {id:'fruitGallery', data:FRUIT_IMGS},
        {id:'animalGallery', data:ANIMAL_IMGS},
        {id:'objectGallery', data:OBJECT_IMGS},
        {id:'symbolGallery', data:SYMBOL_IMGS}
      ];

      galleries.forEach(({id,data})=>{
        const el=document.getElementById(id);
        if(!el) return;
        el.innerHTML='';
        data.forEach(it=>{
          const im=document.createElement('img');
          im.src=it.data;
          im.alt=it.alt;
          im.width=64;
          im.height=64;
          el.appendChild(im);
        });
      });
    }

    // klik image di galeri -> set sebagai template + clear coretan
    ['fruitGallery','animalGallery','objectGallery','symbolGallery'].forEach(id=>{
      const root=document.getElementById(id);
      root.addEventListener('click',(e)=>{
        const imgEl=e.target.closest('img');
        if(!imgEl) return;
        const img=new Image();
        img.crossOrigin='anonymous';
        img.onload=()=>{ setTemplateImage(img); };
        img.onerror=()=> alert('Gambar bawaan gagal dimuat.');
        img.src=imgEl.src;
      });
    });


    // ====== INIT ======
    function init(){ setTool('brush'); buildPalette('Dasar'); populateBuiltinGalleries(); resizeCanvas(); }
    init();
  </script>
</body>
</html>
